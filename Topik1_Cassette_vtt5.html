<!DOCTYPE html>
<html lang="en">
    <head>
        <title>TOPIK-Listening</title>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
        <meta name="keywords" content="cassette, html5, audio, player, css3, buttons, sounds, vintage, old school, javascript, jquery, Korean, TOPIK" />
        <meta name="author" content="Kiyoshi" />
        <link rel="stylesheet" type="text/css" href="https://kiyoshichang.github.io/cassette/css_shortcode/demo.css" />
        
        <script type="text/javascript" src="https://kiyoshichang.github.io/cassette/js_shortcode/modernizr.custom.69142.js"></script> 

        <style>

			@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@900&display=swap');
            /* [!!! 請求 2 修正: 匯入 Oswald, 移除 Orbitron !!!] */
			@import url('https://fonts.googleapis.com/css2?family=Oswald:wght@700&display=swap');

            /* [!!! 請求 2 修正: 絕對防止水平捲軸 !!!] */
            html {
                overflow-x: hidden;
            }

            /* --- [修改 1] 新增 body 和 header 規則 --- */
            
            body {
                overflow-x: hidden;
                /* [!!! 請求 2 修正: 永久移除 demo.css 的 padding !!!] */
                padding: 0px !important;
            }
            
            /* * [關鍵修正]
             * 我們使用 '.container > header' 並加上 '!important' 
             * 來強制覆蓋 'demo.css' 的置左設定。
             */
            .container > header {
                text-align: center !important;
                
                /* [!!! 請求 3: 緊縮頁首 (50%) !!!] 
                 * 原 9px -> 4.5px (取 5px)
                 */
                padding-top: 5px !important;
            }
            
            /* --- [修改 2] 字幕框 --- */
            #subtitle-container {
                max-width: 560px;
                width: 100%;
                
                /* [!! 請求 8 !!] */
                height: 51px; /* 64px * 0.8 = 51.2px */
                
                margin: 0 auto;
                text-align: center;
                
                /* [!!! 請求 1: VTT 改為透明 !!!] */
                background-color: transparent;
                
                border-radius: 5px;
                padding: 10px;
                box-sizing: border-box;
                
                overflow: hidden; 
                
                display: flex;
                align-items: center;
                justify-content: center; /* 水平置中 */

                font-size: 18px;
                line-height: 1.4;
                color: #333;
                font-weight: bold;
                position: relative;
                
                margin-top: -35px;
                
				left: 14px;
            }
            
            /* --- [修改 3] .container 規則 --- */
            body > .container {
                width: 560px !important;
                margin: 0 auto !important;
                padding: 0 !important;
                box-sizing: border-box !important;
                height: auto !important;
                overflow: visible !important;
                
                padding-bottom: 9px;
            }

            /* --- [修改 4] 媒體查詢 (手機縮放) --- */
            /* (JS 處理) */

            /* --- [內嵌 style.css 內容開始] --- */

            /* Main container */
            .vc-container{
                text-align: center;
                /* [!!! 請求 1 & 5: 重新計算高度 !!!] 
                 * 原 500px -> 494px (間距 12px -> 6px)
                 */
                height: 494px; 
                
                margin-bottom: 0px;
                
                position: relative;
            }

            /* Tape elements */
            .vc-tape-wrapper{
                -webkit-perspective: 800px;	
                -moz-perspective: 800px;
                -o-perspective: 800px;
                -ms-perspective: 800px;
                perspective: 800px;
            }
            .vc-tape{
                width: 586px;
                height: 379px;
                
                /* [!!! 請求 4: 緊縮 H2/Tape (50%) !!!] */
                margin: 1px auto 0;
                
                position: relative;
                -webkit-transition: all .4s ease-in-out;	
                -moz-transition: all .4s ease-in-out;
                -o-transition: all .4s ease-in-out;
                -ms-transition: all .4s ease-in-out;
                transition: all .4s ease-in-out;
            }
            .vc-loader{
                position: absolute;
                width: 31px;
                height: 31px;
                bottom: 50px;
                left: 50%;
                margin: -15px 0 0 -15px;
                background: transparent url(https://kiyoshichang.github.io/cassette/images/ajax-loader.gif) no-repeat center center;
                display: none;
            }
            .vc-tape-back{
                width: 100%;
                height: 100%;
                position: relative;
                background: transparent url(https://kiyoshichang.github.io/cassette/images/cs_back.png) no-repeat center center;
            }
            .vc-tape-wheel{
                width: 125px;
                height: 125px;
                position: absolute;
                top: 110px;
                background: transparent;
                border-radius: 50%;
            }
            .vc-tape-wheel-left{
                left: 109px;
                box-shadow: 0 0 0 70px #000;
            }
            .vc-tape-wheel-right{
                right: 113px;
            }
            @-webkit-keyframes rotateLeft {
                0% { -webkit-transform: rotate(0deg) translateZ(-1px); }
                100% { -webkit-transform: rotate(-360deg) translateZ(-1px); }
            }
            @-webkit-keyframes rotateRight {
                0% { -webkit-transform: rotate(0deg) translateZ(-1px); }
                100% { -webkit-transform: rotate(360deg) translateZ(-1px); }
            }
            @-moz-keyframes rotateLeft {
                0% { -moz-transform: rotate(0deg) translateZ(-1px); }
                100% { -moz-transform: rotate(-360deg) translateZ(-1px); }
            }
            @-moz-keyframes rotateRight {
                0% { -moz-transform: rotate(0deg) translateZ(-1px); }
                100% { -moz-transform: rotate(360deg) translateZ(-1px); }
            }
            @-o-keyframes rotateLeft {
                0% { -o-transform: rotate(0deg) translateZ(-1px); }
                100% { -o-transform: rotate(-360deg) translateZ(-1px); }
            }
            @-o-keyframes rotateRight {
                0% { -o-transform: rotate(0deg) translateZ(-1px); }
                100% { -o-transform: rotate(360deg) translateZ(-1px); }
            }
            @-ms-keyframes rotateLeft {
                0% { -ms-transform: rotate(0deg) translateZ(-1px); }
                100% { -ms-transform: rotate(-360deg) translateZ(-1px); }
            }
            @-ms-keyframes rotateRight {
                0% { -ms-transform: rotate(0deg) translateZ(-1px); }
                100% { -ms-transform: rotate(360deg) translateZ(-1px); }
            }
            @keyframes rotateLeft {
                0% { transform: rotate(0deg) translateZ(-1px); }
                100% { transform: rotate(-360deg) translateZ(-1px); }
            }
            @keyframes rotateRight {
                0% { transform: rotate(0deg) translateZ(-1px); }
                100% { transform: rotate(360deg) translateZ(-1px); }
            }
            .vc-tape-wheel div{
                width: 100%;
                height: 100%;
                background: transparent url(https://kiyoshichang.github.io/cassette/images/cs_wheel.png) no-repeat center center;
            }
            .vc-tape-front{
                width: 100%;
                height: 100%;
                position: absolute;
                background: transparent url(https://kiyoshichang.github.io/cassette/images/cs_front_TOPIK.png) no-repeat center center;
                top: 0px;
                left: 0px;
            }
            .vc-tape-side-b{
                display: none;
                -webkit-transform: rotate3d(0, 1, 0, 180deg);
                -moz-transform: rotate3d(0, 1, 0, 180deg);
                -o-transform: rotate3d(0, 1, 0, 180deg);
                -ms-transform: rotate3d(0, 1, 0, 180deg);
                transform: rotate3d(0, 1, 0, 180deg);
            }

            .vc-tape-front span{
                color: rgba(0, 0, 0, 0.6);
                position: absolute;
                top: 83px;
                left: 67px;
                font-family: Arial;
                font-weight: bold;
                font-size: 20px;
            }

            /* Controls list */
            ul.vc-controls{
                list-style: none;
                padding: 0;
                width: 440px;
                position: absolute;
                bottom: 18px;
                left: 50%;
                margin: 0 0 0 -170px;
                background: -moz-linear-gradient(top, rgba(170,170,170,0.35) 0%, rgba(255,255,255,0.44) 50%, rgba(255,255,255,0.53) 100%);
                background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(170,170,170,0.35)), color-stop(50%,rgba(255,255,255,0.44)), color-stop(100%,rgba(255,255,255,0.53)));
                background: -webkit-linear-gradient(top, rgba(170,170,170,0.35) 0%,rgba(255,255,255,0.44) 50%,rgba(255,255,255,0.53) 100%);
                background: -o-linear-gradient(top, rgba(170,170,170,0.35) 0%,rgba(255,255,255,0.44) 50%,rgba(255,255,255,0.53) 100%);
                background: -ms-linear-gradient(top, rgba(170,170,170,0.35) 0%,rgba(255,255,255,0.44) 50%,rgba(255,255,255,0.53) 100%);
                background: linear-gradient(to bottom, rgba(170,170,170,0.35) 0%,rgba(255,255,255,0.44) 50%,rgba(255,255,255,0.53) 100%);
                filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#59aaaaaa', endColorstr='#87ffffff',GradientType=0 );
                border: 1px solid rgba(0,0,0,0.1);
                border-bottom-color: rgba(255,255,255,0.6);
                padding: 8px;
                height: 54px;
                box-shadow: 
                    inset 0 1px 0px rgba(0,0,0,0.05),
                    0 1px 0 rgba(255,255,255,0.8),
                    0 -1px 0 rgba(255,255,255,0.4),
                    inset 0 2px 19px rgba(0,0,0,0.05),
                    0 2px 1px rgba(0,0,0,0.06);
                -webkit-box-sizing: content-box;
                -moz-box-sizing: content-box;
                box-sizing: content-box;
                border-radius: 12px;
            }

            /* Controls list items */
            ul.vc-controls li {
                display: block;
                float: left;
                width: 80px;
                height: 50px;
                line-height: 55px;
                text-align: left;
                padding: 10px;
                margin: 0;
                cursor: pointer;
                background: #ddd url(https://kiyoshichang.github.io/cassette/images/metal.jpg) no-repeat center top;
                box-shadow: 
                    inset 0 0 0 1px rgba(0,0,0, 0.2), 
                    inset 0 0 1px 2px rgba(255,255,255,0.9),
                    inset 0 -6px 5px rgba(0,0,0,0.1),
                    0 6px 7px rgba(0,0,0,0.3),
                    0 4px 1px rgba(0,0,0,0.5);
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                -khtml-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }

            ul.vc-controls li:first-child{
                border-radius: 8px 0 0 8px;
            }

            ul.vc-controls li:last-child{
                border-radius: 0px 8px 8px 0px;
            }

            ul.vc-controls li.vc-control-play{
                width: 120px;
            }

            /* Control icons */
            ul.vc-controls li span:before{
                font-size: 16px;
                line-height: 50px;
                text-align: center;
                float: left;
                color: #444;
                font-family: 'playericons';
                text-shadow:  1px 1px 1px rgba(255,255,255,0.9);
                font-style: normal;
                font-weight: normal;
                text-transform: none;
                speak: none;
                display: inline-block;
                text-decoration: inherit;
                width: 1em;
                margin-right: 0.2em;
                text-align: center;
            }

            li.vc-control-pause span:before { content: '\50'; } 
            li.vc-control-fforward span:before { content: '\23e9'; } 
            li.vc-control-rewind span:before { content: '\23ea'; } 
            li.vc-control-stop span:before { content: '\25aa'; } 
            li.vc-control-play span:before { content: '\70'; } 
            li.vc-control-volume-off span:before { content: 'ðŸ”‡'; } 
            li.vc-control-volume-down span:before { content: 'ðŸ”‰'; } 
            li.vc-control-volume-up span:before { content: 'ðŸ”Š'; } 

            ul.vc-controls li:hover{
                box-shadow: 
                    inset 0 0 0 1px rgba(0,0,0, 0.2), 
                    inset 0 0 1px 2px rgba(255,255,255,0.9),
                    inset 0 -10px 15px rgba(0,0,0,0.1),
                    0 6px 7px rgba(0,0,0,0.3),
                    0 4px 1px rgba(0,0,0,0.5);
            }

            /* Pressed (active) */
            ul.vc-controls li.vc-control-active{
                height: 50px;
                margin-top: 2px;
                background-image: url(https://kiyoshichang.github.io/cassette/images/metal_dark.jpg);
                box-shadow: 
                    inset 0 0 0 1px rgba(0,0,0, 0.18), 
                    inset 0 0 1px 2px rgba(255,255,255,0.5),
                    inset 0 -6px 5px rgba(0,0,0,0.1),
                    0 6px 7px rgba(0,0,0,0.3),
                    0 2px 1px rgba(0,0,0,0.5);

            }

            /* Activated */
            ul.vc-controls li.vc-control-pressed,
            ul.vc-controls li.vc-control-active.vc-control-pressed{
                height: 50px;
                background-image: url(https://kiyoshichang.github.io/cassette/images/metal_dark.jpg);
                margin-top: 4px;
                box-shadow: 
                    inset 0 0 0 1px rgba(0,0,0, 0.2), 
                    inset 0 0 5px 1px rgba(255,255,255,0.5),
                    inset 0 -10px 15px rgba(0,0,0,0.2),
                    0 7px 5px rgba(255,255,255,0.5);
            }

            /* Background for the volume knob 
            See knobKnob.css for the knob style
            */
            .vc-volume-wrap{
                width: 100px;
                height: 100px;
                position: absolute;
                bottom: 0px;
                left: 50%;
                margin-left: -318px;
                background: -moz-linear-gradient(top, rgba(170,170,170,0.35) 0%, rgba(255,255,255,0.44) 50%, rgba(255,255,255,0.53) 100%);
                background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(170,170,170,0.35)), color-stop(50%,rgba(255,255,255,0.44)), color-stop(100%,rgba(255,255,255,0.53)));
                background: -webkit-linear-gradient(top, rgba(170,170,170,0.35) 0%,rgba(255,255,255,0.44) 50%,rgba(255,255,255,0.53) 100%);
                background: -o-linear-gradient(top, rgba(170,170,170,0.35) 0%,rgba(255,255,255,0.44) 50%,rgba(255,255,255,0.53) 100%);
                background: -ms-linear-gradient(top, rgba(170,170,170,0.35) 0%,rgba(255,255,255,0.44) 50%,rgba(255,255,255,0.53) 100%);
                background: linear-gradient(to bottom, rgba(170,170,170,0.35) 0%,rgba(255,255,255,0.44) 50%,rgba(255,255,255,0.53) 100%);
                filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#59aaaaaa', endColorstr='#87ffffff',GradientType=0 );
                border: 1px solid rgba(0,0,0,0.1);
                border-bottom-color: rgba(255,255,255,0.6);
                padding: 8px;
                box-shadow: 
                    inset 0 1px 0px rgba(0,0,0,0.05),
                    0 1px 0 rgba(255,255,255,0.8),
                    0 -1px 0 rgba(255,255,255,0.4),
                    inset 0 2px 19px rgba(0,0,0,0.05),
                    0 2px 1px rgba(0,0,0,0.06);
                -webkit-box-sizing: content-box;
                -moz-box-sizing: content-box;
                box-sizing: content-box;
                border-radius: 50%;
            }

            .vc-volume-wrap:after{
                content: 'Volume';
                margin-top: 15px;
                display: block;
            }

            /* Text style for controls */
            ul.vc-controls li,
            .vc-volume-wrap:after{
                font-family: 'Aldrich';
                font-size: 10px;
                font-weight: 300;
                text-transform: uppercase;
                letter-spacing: 1px;
                color: #666;
                text-shadow: 0 1px 1px rgba(255,255,255,0.8);
            }
            /* --- [內嵌 style.css 內容結束] --- */


            /* --- [內嵌 knobKnob.css 內容開始] --- */
            /*----------------------------
                knobKnob Styles
            -----------------------------*/
            .knob{
                width: 100px;
                height: 100px;
                position: relative;
            }

            .knob .top{
                position: absolute;
                width: 100%;
                height: 100%;
                background: url(https://kiyoshichang.github.io/cassette/images/knob.jpg) no-repeat center center;
                z-index: 10;
                cursor: default !important;
                border-radius: 50%;
                box-shadow: inset 0 0 3px 2px rgba(255,255,255,0.6);
            }

            .knob .base{
                width: 100%;
                height: 100%;
                box-shadow: 0 5px 0 #555, 0px 5px 5px black;
                position: absolute;
                z-index: 1;
                border-radius: 50%;
            }

            .knob .top:after{
                content: '';
                width: 4px;
                height: 4px;
                background-color: #666;
                position: absolute;
                top: 50%;
                margin-top: -2px;
                left: 4px;
                border-radius: 50%;
                cursor: default !important;
                box-shadow:  
                    0 0 1px #5a5a5a inset, 
                    1px -1px 1px rgba(255,255,255,0.5);
            }

            .knob [draggable] {
              -moz-user-select:  none;
              -webkit-user-select:  none;
              user-select:  none;
            }
            /* --- [內嵌 knobKnob.css 內容結束] --- */
            

            /* --- [!!! 這是我的新 CSS 覆寫規則 !!!] --- */

            /* 1. 移除音量旋鈕外框, 重新定位並縮小 */
            .vc-volume-wrap {
                background: none !important;
                border: none !important;
                box-shadow: none !important;
                
                /* 重新定位: 左側切齊, 並與控制面板垂直對齊 */
                left: 19px !important; 
                margin-left: 0 !important;
                bottom: 18px !important; /* 與 ul.vc-controls 的 bottom 對齊 */
                
                /* 縮小尺寸 (85%) */
                width: 85px !important; 
                height: auto !important; /* 高度自動, 以容納旋鈕+文字 */
                padding: 0 !important; /* 移除原有的 8px padding */
            }

            /* 2. 調整 "VOLUME" 文字與縮小後旋鈕的間距 */
            .vc-volume-wrap:after {
                margin-top: 10px !important; /* 調整 85px 旋鈕下方的間距 */
                /* 文字大小 (font-size) 繼承原有規則, 保持不變 */
            }

            /* 3. 將旋鈕本身 (及其組件) 縮小為 85px */
            .knob, .knob .top, .knob .base {
                width: 85px !important;
                height: 85px !important;
            }
            
            /* 4. 移除五鍵控制面板的外框 */
			ul.vc-controls {
                background: none !important;
                border: none !important;
                box-shadow: none !important;
                padding: 0 !important; /* 移除 8px padding, 讓 440px 寬度剛好容納按鈕 */
                
                /* 位置: 依需求維持原樣 (left: 50%, margin-left: -170px) */
                
                /* 確保寬度正確, 防止按鈕換行 */
                width: 440px !important; 
                /* 確保 box-sizing 正確 (雖然它本來就是 content-box) */
                box-sizing: content-box !important;

                /* [!!! 請求 1 修正: 恢復 54px !!!] */
                bottom: 54px !important;

				/* [!! 第 2 處修改!!] 往右移 19px (原為 -170px) */
                margin-left: -151px !important;
            }
            
            /* --- [!!! 放大標題文字 (已修正巢狀錯誤) !!!] --- */

			.container > header h1 {
                /* [!!! 請求 2 修正: 字型 !!!] */
                font-family: 'Oswald', sans-serif;
                font-weight: 700 !important; 
                
                /* [!!! 請求 2 修正: 尺寸/字距 !!!] */
                font-size: 38px;
                line-height: 38px;
                white-space: nowrap;
                letter-spacing: -1px;
                
                /* [!!! 請求 2 修正: 補償 H2 間距 !!!] */
                padding-bottom: 2px;
            }

            /* [!!! 請求 2 修正: 刪除 H2 樣式 !!!] */
            
            /* --- [!!! 覆寫規則結束 !!!] --- */
			

            /* --- [!!! 這是新的 KTV 樣式 (融合 Gemini1 外觀 + ChatGPT2 語法) !!!] --- */
            
            #subtitle-container .cue {
                position: relative;
                margin: 0;
                overflow: visible; 
                line-height: 1.4;
                
                /* [!! 佈局修正 5 !!] */
                font-family: 'Noto Sans KR', sans-serif;
                font-size: 30px; 
                font-weight: 900;
                white-space: nowrap; /* 強制不斷行 */
                letter-spacing: -1.5px; /* 縮小字距 */
                
                width: auto;
                max-width: 100%; 
                text-align: left;
                
                display: none;
            }

            /* 兩層文字容器 */
            #subtitle-container .text-wrap { 
                position: relative; 
                display:inline-block; 
            }

            /* [!!! KTV 邏輯修改 !!!] */

            /* 底層 (SUNG): 藍字 + 白光暈 (來自您原本的 .front 樣式) */
            #subtitle-container .back {
                position: relative; 
                left:0; top:0;
                z-index: 1;
                color: #007BFF; 
                
                /* [!! 佈局修正 6 !!] */
                text-shadow: 0 0 2px #fff, 0 0 5px #fff, 0 0 10px #fff;

                -webkit-font-smoothing: antialiased;
            }

            /* 上層 (UN-SUNG): 白字 + 黑陰影 (來自您原本的 .back 樣式) */
            #subtitle-container .front {
                position: absolute;
                left:0; top:0;
                width: 100%;
                height: 100%; 
                z-index: 2;
                color: #ffffff; 

                /* [!! 佈局修正 7 !!] */
                text-shadow: 0 0 2px #000, 0 0 5px #000, 0 0 8px #000;

                -webkit-font-smoothing: antialiased;
                
                /* [!! KTV 核心動畫: 採用 ChatGPT2 語法 !!] */
                -webkit-clip-path: inset(0 0 0 var(--left, 0%));
                clip-path: inset(0 0 0 var(--left, 0%));
                transition: none; 
            }
            
            
            /* --- [!!! 新增圖片框樣式 !!!] --- */
            #image-container {
                max-width: 560px; /* 配合 VTT 框寬度 */
                width: 100%;
                
                /* [!!! 請求 1 修正: 縮小距離 !!!] */
                margin: 6px auto 0;
                
                /* [!! 關鍵對齊 !!] */
                position: relative;
                left: 14px; 
                box-sizing: border-box; 
                
                /* [!!! 請求 2 修正: 變透明 !!!] */
                background: transparent;
                padding: 0;
                border-radius: 0;
                box-shadow: none; 
                
                /* [!!! 請求 1 修正: 預設隱藏 !!!] */
                display: none; 

                overflow: hidden;
            }
            
            /* [!!! 請求 1 修正 (Bug): 
             * 當 .image-visible class 存在時 (JS .show() 觸發),
             * 我們才把它設為 block (窄螢幕) 
             * 這修復了 F12 測試時圖片消失的問題
             * !!!]
             */
            #image-container.image-visible {
                display: block;
            }
            
            #image-container img {
                /* [!!! 請求 1 修正: 恢復窄螢幕(手機)的設定 !!!] */
                width: 100%;
                height: auto;
                object-fit: unset;

                display: block;
                border-radius: 0; 
            }
            
            /* [!!! 請求 2 修正: 寬螢幕(電腦)的 Flexbox 佈局 !!!] */
            @media (min-width: 587px) { /* [!!! 請求 2 修正: 設為 587px !!!] */
                
                /* 1. 讓 .container 填滿螢幕高度 */
                body > .container {
                    display: flex;
                    flex-direction: column;
                    min-height: calc(100vh - 9px); /* 100vh 減去 9px bottom padding */
                }
                
                /* 2. 讓 #image-container 佔滿所有剩餘空間 */
                /* [!!! 請求 1 修正 (Bug):
                 * 我們只在 .image-visible class 存在時才套用 flex,
                 * 這樣 .display: none 預設值才能正常運作 (隱藏破碎圖示)
                 * !!!]
                 */
                #image-container.image-visible {
                    display: flex !important; /* 強制 flex 覆蓋 display: block */
                    flex-grow: 1; /* 自動長高 */
                    flex-shrink: 1; /* 允許縮小 */
                    flex-basis: 0; /* 基礎高度 0 */
                    min-height: 0; /* 修正 flex 溢出問題 */
                }
                
                /* 3. 讓 img 等比例填滿 #image-container */
                #image-container img {
                    width: 100%;
                    height: 100%;
                    object-fit: contain; /* 等比例縮放, 不裁切 */
                }
            }
            
        </style>

    </head>
    <body>
        <div class="container">			
			<header>
			
				<h1>Kiyoshi's Cassette Player</h1>
                <div class="support-note"><span class="no-cssanimations">CSS animations are not supported in your browser</span>
					<span class="no-csstransforms">CSS transforms are not supported in your browser</span>
					<span class="no-csstransforms3d">CSS 3D transforms are not supported in your browser</span>
					<span class="no-csstransitions">CSS transitions are not supported in your browser</span>
					<span class="note-ie">Sorry, only modern browsers.</span>
				</div>
				
			</header>

			<div id="vc-container" class="vc-container">
				<div class="vc-tape-wrapper">
					<div class="vc-tape">
						<div class="vc-tape-back">
							<div class="vc-tape-wheel vc-tape-wheel-left"><div></div></div>
							<div class="vc-tape-wheel vc-tape-wheel-right"><div></div></div>
						</div>
						<div class="vc-tape-front vc-tape-side-a">
							<span>A</span>
						</div>
						<div class="vc-tape-front vc-tape-side-b">
							<span>B</span>
						</div>
					</div>
				</div>
				<div class="vc-loader"></div>
			</div>
            
            <div id="subtitle-container">
            </div>
            
            <div id="image-container">
                <img id="track-image" alt="" />
            </div>
		
		</div>

		<script type="text/javascript" src="https://kiyoshichang.github.io/cassette/js/jquery.min.js"></script>
		<script src="https://kiyoshichang.github.io/cassette/js_shortcode/transform.js"></script>
		<script src="https://kiyoshichang.github.io/cassette/js_shortcode/knobKnob.jquery.js"></script>

<script>
// [!!! 歌詞資料庫 (維持不變) !!!]
var karaokeDatabase = {
    
    'Topik1-96th-15': [
        { s: 0.1, e: 6.0, text: "어서 오세요, 손님. 뭘 도와드릴까요?" },
        { s: 6.0, e: 12.0, text: "남자 옷은 몇 층에 있어요?" },
        { s: 15.5, e: 21.5, text: "어서 오세요, 손님. 뭘 도와드릴까요?" },
        { s: 21.5, e: 27.0, text: "남자 옷은 몇 층에 있어요?" }
    ],
    
    'Topik1-96th-16': [
        { s: 0.1, e: 6.5, text: "수미 씨, 이 사진 여기에 걸까요?" },
        { s: 6.5, e: 13.5, text: "음, 조금 더 위에 걸어 주세요." },
        { s: 17.5, e: 24.5, text: "수미 씨, 이 사진 여기에 걸까요?" },
        { s: 24.5, e: 32.0, text: "음, 조금 더 위에 걸어 주세요." }
    ],

    'Topik1-91st-15': [
        { s: 0.1, e: 6.5, text: "이것보다 작은 가방 있어요?" },
        { s: 6.5, e: 15.5, text: "네, 가게 안에 있어요. 들어와서 보세요." },
        { s: 19.0, e: 25.5, text: "이것보다 작은 가방 있어요?" },
        { s: 25.5, e: 34.0, text: "네, 가게 안에 있어요. 들어와서 보세요." }
    ],
    
    'Topik1-91st-16': [
        { s: 0.1, e: 5.5, text: "책상 위에 물이 있네요." },
        { s: 5.5, e: 10.5, text: "그럼 이걸로 닦으세요." },
        { s: 14.5, e: 20.0, text: "책상 위에 물이 있네요." },
        { s: 20.0, e: 25.0, text: "그럼 이걸로 닦으세요." }
    ],
    
    'Topik1-83rd-15': [
        { s: 0.1, e: 5.5, text: "저, 우산은 어디에 있어요?" },
        { s: 5.5, e: 10.5, text: "저기 창문 밑에 있습니다." },
        { s: 15.0, e: 21.0, text: "저, 우산은 어디에 있어요?" },
        { s: 21.0, e: 26.5, text: "저기 창문 밑에 있습니다." }
    ],
    
    'Topik1-83rd-16': [
        { s: 0.1, e: 6.0, text: "우리 15 번 버스를 타지요?" },
        { s: 6.0, e: 12.0, text: "네. 이 정류장에서 탈 수 있네요." },
        { s: 17.0, e: 23.0, text: "우리 15 번 버스를 타지요?" },
        { s: 23.0, e: 29.0, text: "네. 이 정류장에서 탈 수 있네요." }
    ],
    
    'Topik1-64th-15': [
        { s: 0.1, e: 5.5, text: "어디가 아파서 오셨어요?" },
        { s: 5.5, e: 12.0, text: "어제부터 계속 배가 아파서요." },
        { s: 17.0, e: 22.5, text: "어디가 아파서 오셨어요?" },
        { s: 22.5, e: 30.0, text: "어제부터 계속 배가 아파서요." }
    ],
    
    'Topik1-64th-16': [
        { s: 0.1, e: 9.0, text: "식탁이 무거운데 같이 좀 들어 줄래요?" },
        { s: 9.0, e: 15.5, text: "네. 제가 여기를 들게요." },
        { s: 20.0, e: 29.5, text: "식탁이 무거운데 같이 좀 들어 줄래요?" },
        { s: 29.5, e: 36.0, text: "네. 제가 여기를 들게요." }
    ],
    
    'Topik1-60th-15': [
        { s: 0.1, e: 5.0, text: "이 수박 얼마예요?" },
        { s: 5.0, e: 10.5, text: "만 원이에요. 하나 드릴까요?" },
        { s: 15.0, e: 20.5, text: "이 수박 얼마예요?" },
        { s: 20.5, e: 25.5, text: "만 원이에요. 하나 드릴까요?" }
    ],
    
    'Topik1-60th-16': [
        { s: 0.1, e: 6.0, text: "수미 씨, 늦어서 미안해요." },
        { s: 6.0, e: 14.5, text: "아직 영화 시작 안 했어요. 들어가요." },
        { s: 19.5, e: 26.0, text: "수미 씨, 늦어서 미안해요." },
        { s: 26.0, e: 34.5, text: "아직 영화 시작 안 했어요. 들어가요." }
    ],
    
    'Topik1-47th-15': [
        { s: 0.1, e: 4.5, text: "저거, 우리 가방 같은데요." },
        { s: 4.5, e: 10.0, text: "제가 가지고 올게요. 잠깐만 기다려요." },
        { s: 16.5, e: 21.0, text: "저거, 우리 가방 같은데요." },
        { s: 21.0, e: 27.0, text: "제가 가지고 올게요. 잠깐만 기다려요." }
    ],
    
    'Topik1-47th-16': [
        { s: 0.1, e: 7.2, text: "음, 편하고 좋네요. 그런데 좀 짧은 거 같아요." },
        { s: 7.2, e: 12.5, text: "그럼 이 바지를 한번 입어 보세요." },
        { s: 19.5, e: 27.0, text: "음, 편하고 좋네요. 그런데 좀 짧은 거 같아요." },
        { s: 27.0, e: 32.0, text: "그럼 이 바지를 한번 입어 보세요." }
    ]
};

/* [!!! 新增圖片資料庫 !!!] */
var imageDatabase = {
    'Topik1-96th-15': 'https://mon-ami.up.seesaa.net/topik/Topik1-96th-15a.png',
    'Topik1-96th-16': 'https://mon-ami.up.seesaa.net/topik/Topik1-96th-16a.png',
    'Topik1-91st-15': 'https://mon-ami.up.seesaa.net/topik/Topik1-91st-15a.png',
    'Topik1-91st-16': 'https://mon-ami.up.seesaa.net/topik/Topik1-91st-16a.png',
    'Topik1-83rd-15': 'https://mon-ami.up.seesaa.net/topik/Topik1-83rd-15a.png',
    'Topik1-83rd-16': 'https://mon-ami.up.seesaa.net/topik/Topik1-83rd-16d.png',
    'Topik1-64th-15': 'https://mon-ami.up.seesaa.net/topik/Topik1-64th-15c.png',
    'Topik1-64th-16': 'https://mon-ami.up.seesaa.net/topik/Topik1-64th-16a.png',
    'Topik1-60th-15': 'https://mon-ami.up.seesaa.net/topik/Topik1-60th-15a.png',
    'Topik1-60th-16': 'https://mon-ami.up.seesaa.net/topik/Topik1-60th-16a.png',
    'Topik1-47th-15': 'https://mon-ami.up.seesaa.net/topik/Topik1-47th-15a.png',
    'Topik1-47th-16': 'https://mon-ami.up.seesaa.net/topik/Topik1-47th-16a.png'
};


 ( function( window, $, undefined ) {
	
	var aux = {
	
		getSupportedType	: function() {
			
			var audio = document.createElement( 'audio' );
			
			if ( audio.canPlayType('audio/mpeg;') ) {
				
				return 'mp3';
			
			}
			else if ( audio.canPlayType('audio/ogg;') ) {
			
				return 'ogg';
			
			}
			else {
				
				return 'wav';
			
			}
		
		}
	
	};
	
	// Cassette obj
	$.Cassette 			= function( options, element ) {
	
		this.$el = $( element );
		this._init( options );
		
	};
	
	$.Cassette.defaults 	= {
		// song names. Assumes the path is "https://mon-ami.up.seesaa.net/topik/"

		songs			: [ 
			
		'Topik1-96th-15', 
		'Topik1-96th-16', 
		'Topik1-91st-15', 
		'Topik1-91st-16', 
		'Topik1-83rd-15', 
		'Topik1-83rd-16',		
		'Topik1-64th-15', 
		'Topik1-64th-16', 
		'Topik1-60th-15', 
		'Topik1-60th-16', 
		'Topik1-47th-15', 
		'Topik1-47th-16', 

		],
		fallbackMessage	: 'HTML5 audio not supported',
		// initial sound volume
		initialVolume	: 0.7
	};
	
	$.Cassette.prototype 	= {

		_init				: function( options ) {
			
			var _self = this;
			
			// the options
			this.options		= $.extend( true, {}, $.Cassette.defaults, options );
			
			// current side of the tape
			this.currentSide	= 1;
			// current time of playing side
			this.cntTime		= 0;
			// current sum of the duration of played songs 
			this.timeIterator	= 0;
			// used for rewind / forward
			this.elapsed		= 0.0;
			// action performed
			this.lastaction		= '';
			// if play / forward / rewind active..
			this.isMoving		= false;
            
            this.currentSongName = '';
            
            // KTV 用的新變數
            this.raf = null; 
            this.$subtitleContainer = $('#subtitle-container'); 
            
            this.$imageContainer = $('#image-container');
            this.$trackImage = $('#track-image');
            
            // [!!! 請求 3 修正: 自動翻面計時器 !!!]
            this.flipTimer = null; 

			this.$loader		= this.$el.find( 'div.vc-loader' ).show();

			// create cassette sides
			$.when( this._createSides() ).done( function() {
			
				_self.$loader.hide();
			
				// create player
				_self._createPlayer();
				_self.sound = new $.Sound();
				// load events
				_self._loadEvents();
				
			} );
			
		},
		_getSide			: function() {

			return ( this.currentSide === 1 ) ? {
				current : this.side1,
				reverse : this.side2	
			} : {
				current : this.side2,
				reverse : this.side1	
			};

		},
		// songs are distributed equally on both sides
		_createSides		: function() {
		
			var playlistSide1 	= [],
				playlistSide2 	= [],
				_self 			= this, 
				cnt 			= 0;
				
			return $.Deferred(
			
				function( dfd ) {
				
					for( var i = 0, len = _self.options.songs.length; i < len; ++i ) {
						
						var song = new $.Song( _self.options.songs[i], i );
						
						$.when( song.loadMetadata() ).done( function( song ) {
							
							( song.id < len / 2 ) ? playlistSide1.push( song ) : playlistSide2.push( song );
							
							++cnt;
							
							if( cnt === len ) {
								
								// two sides, each side with multiple songs
								_self.side1 	= new $.Side( 'side1', playlistSide1, 'start' ),
								_self.side2		= new $.Side( 'side2', playlistSide2, 'end' );
								
								dfd.resolve();
							
							}
							
						} );
						
					}
			
				}
				
			).promise();
			
		},
		_createPlayer		: function() {
			
			// create HTML5 audio element
			this.$audioEl	= $( '<audio id="audioElem"><span>' + this.options.fallbackMessage + '</span></audio>' );
			this.$el.prepend( this.$audioEl );
			
			this.audio		= this.$audioEl.get(0);

			// create custom controls
			this._createControls();

			this.$theTape	= this.$el.find( 'div.vc-tape' );
			this.$wheelLeft	= this.$theTape.find( 'div.vc-tape-wheel-left' );
			this.$wheelRight= this.$theTape.find( 'div.vc-tape-wheel-right' );
			this.$tapeSideA	= this.$theTape.find( 'div.vc-tape-side-a' ).show();
			this.$tapeSideB	= this.$theTape.find( 'div.vc-tape-side-b' );
			
		},
		_createControls		: function() {

			var _self		= this;
			
			this.$controls 	= $( '<ul class="vc-controls" style="display:none;"/>' );
			
			this.$cPlay		= $( '<li class="vc-control-play">Play<span></span></li>' );
			this.$cRewind	= $( '<li class="vc-control-rewind">Rew<span></span></li>' );
			this.$cForward	= $( '<li class="vc-control-fforward">FF<span></span></li>' );
			this.$cStop		= $( '<li class="vc-control-stop">Stop<span></span></li>' );
			this.$cSwitch	= $( '<li class="vc-control-switch">Switch<span></span></li>' );
			
			this.$controls.append( this.$cPlay )
						  .append( this.$cRewind )
						  .append( this.$cForward )
						  .append( this.$cStop )
						  .append( this.$cSwitch )
						  .appendTo( this.$el );

			this.$volume 	= $( '<div style="display:none;" class="vc-volume-wrap"><div class="vc-volume-control"><div class="vc-volume-knob"></div></div></div> ').appendTo( this.$el );

			if (document.createElement('audio').canPlayType) {

				if (!document.createElement('audio').canPlayType('audio/mpeg') && !document.createElement('audio').canPlayType('audio/ogg')) {

					// TODO: flash fallback!
				
				} 
				else {

					this.$controls.show();
					this.$volume.show();
					this.$volume.find( 'div.vc-volume-knob' ).knobKnob({
						snap : 10,
						value: 359 * this.options.initialVolume,
						turn : function( ratio ) {
							
							_self._changeVolume( ratio );
						
						}
					});

					this.audio.volume = this.options.initialVolume;
				}

			}
			
		},
		_loadEvents			: function() {
			
			var _self = this;
			
			this.$cSwitch.on( 'mousedown', function( event ) {
				
				_self._setButtonActive( $( this ) );
				_self._switchSides();
				
			} );
			
			this.$cPlay.on( 'mousedown', function( event ) {
				
				_self._setButtonActive( $( this ) );
				_self._play();
				
			} );
			
			this.$cStop.on( 'mousedown', function( event ) {
				
				_self._setButtonActive( $( this ) );
				_self._stop();

			} );

			this.$cForward.on( 'mousedown', function( event ) {
				
				_self._setButtonActive( $( this ) );
				_self._forward();
			
			} );

			this.$cRewind.on( 'mousedown', function( event ) {
				
				_self._setButtonActive( $( this ) );				
				_self._rewind();
			
			} );
			
			this.$audioEl.on( 'timeupdate', function( event ) {
			
				_self.cntTime	= _self.timeIterator + _self.audio.currentTime;
				var wheelVal	= _self._getWheelValues( _self.cntTime );
				_self._updateWheelValue( wheelVal );
                
			});
            
            // --- [!! KTV 事件綁定 !!] ---
            this.$audioEl.on( 'play', function() {
                _self._startKaraoke();
            });
            this.$audioEl.on( 'pause', function() {
                _self._stopKaraoke();
            });
            this.$audioEl.on( 'seeked', function() {
                _self._updateKaraoke(); // seeked 後立即更新一次
            });
            // --- [ KTV 綁定結束 ] ---
			
			this.$audioEl.on( 'loadedmetadata', function( event ) {
				
			});

			this.$audioEl.on( 'ended', function( event ) {
				
				_self.timeIterator += _self.audio.duration;
				_self._play();
				
			});
		
		},
		_setButtonActive	: function( $button ) {

			// TODO. Solve! For now:
			$button.addClass( 'vc-control-pressed' );

			setTimeout( function() {
				
				$button.removeClass( 'vc-control-pressed' );	
				
			}, 100 );

		},	
		_updateAction		: function( action ) {

			this.lastaction = action;

		},
        
		_prepare			: function( song ) {
		
            var _self = this; 

			this._clear();
			this.$audioEl.attr( 'src', song.getSource( aux.getSupportedType() ) );
            
            this.currentSongName = song.name;
            
            // --- [!! KTV: 動態建立 KTV HTML !!] ---
            
            this.$subtitleContainer.empty();
            this._stopKaraoke(); 
            
            var cues = karaokeDatabase[this.currentSongName];
            
            if (cues && cues.length > 0) {
                
                cues.forEach(c => {
                    const cue = document.createElement('div');
                    cue.className = 'cue';
                    cue.dataset.start = c.s; 
                    cue.dataset.end = c.e;   

                    const wrap = document.createElement('span');
                    wrap.className = 'text-wrap';
                    
                    const back = document.createElement('span');
                    back.className = 'back';
                    back.innerHTML = c.text.replace(/\n/g, '<br/>'); 
                    
                    const frontWrapper = document.createElement('span');
                    frontWrapper.className = 'front';
                    frontWrapper.innerHTML = c.text.replace(/\n/g, '<br/>'); 

                    wrap.appendChild(back);
                    wrap.appendChild(frontWrapper);
                    cue.appendChild(wrap);

                    this.$subtitleContainer.append(cue);
                });
            }
            // --- [ KTV HTML 建立完畢 ] ---
            
            
            // [!!! 載入圖片 !!!]
            var imageUrl = imageDatabase[this.currentSongName];
            if (imageUrl) {
                this.$trackImage.attr('src', imageUrl);
                
                /* [!!! 請求 1 修正: 使用 class 來顯示 !!!] */
                this.$imageContainer.addClass('image-visible');
            } else {
                this.$trackImage.removeAttr('src');
                this.$imageContainer.removeClass('image-visible');
            }
			
		},
		_switchSides		: function() {
            
            // [!!! 請求 3 修正: 取消計時器 !!!]
            clearTimeout(this.flipTimer);

			if( this.isMoving ) {

				alert( 'Please stop the player before switching sides.' );
				return false;

			}
			
			this.sound.play( 'switch' );

			var _self = this;

			this.lastaction = '';

			if( this.currentSide === 1 ) {

				this.currentSide = 2;

				this.$theTape.css( {
					'-webkit-transform'	: 'rotate3d(0, 1, 0, 180deg)',
					'-moz-transform'	: 'rotate3d(0, 1, 0, 180deg)',
					'-o-transform'		: 'rotate3d(0, 1, 0, 180deg)',
					'-ms-transform'	: 'rotate3d(0, 1, 0, 180deg)',
					'transform'			: 'rotate3d(0, 1, 0, 180deg)'
				} );

				setTimeout( function() {

					_self.$tapeSideA.hide();
					_self.$tapeSideB.show();

					// update wheels
					_self.cntTime = _self._getPosTime();

				}, 200 );

			} 
			else {

				this.currentSide = 1;

				this.$theTape.css( {
					'-webkit-transform'	: 'rotate3d(0, 1, 0, 0deg)',
					'-moz-transform'	: 'rotate3d(0, 1, 0, 0deg)',
					'-o-transform'		: 'rotate3d(0, 1, 0, 0deg)',
					'-ms-transform'	: 'rotate3d(0, 1, 0, 0deg)',
					'transform'			: 'rotate3d(0, 1, 0, 0deg)'
				} );

				setTimeout( function() {

					_self.$tapeSideB.hide();
					_self.$tapeSideA.show();

					// update wheels
					_self.cntTime = _self._getPosTime();
					
				}, 200 );

			}

		},

		_updateButtons		: function( button ) {

			var pressedClass = 'vc-control-active';

			this.$cPlay.removeClass( pressedClass );
			this.$cStop.removeClass( pressedClass );
			this.$cRewind.removeClass( pressedClass );
			this.$cForward.removeClass( pressedClass );

			switch( button ) {

				case 'play'		: this.$cPlay.addClass( pressedClass ); break;
				case 'rewind'	: this.$cRewind.addClass( pressedClass ); break;
				case 'forward'	: this.$cForward.addClass( pressedClass ); break;

			}

		},
		_changeVolume		: function( ratio ) {

			this.audio.volume = ratio;
			
		},
		_play				: function() {
            
            // [!!! 請求 3 修正: 取消計時器 !!!]
            clearTimeout(this.flipTimer);

			var _self	= this;

			this._updateButtons( 'play' );

			$.when( this.sound.play( 'click' ) ).done( function() {

				var data	= _self._updateStatus();

			if( data ) {

					_self._prepare( _self._getSide().current.getSong( data.songIdx ) );
				
					_self.$audioEl.on( 'canplay', function( event ) {

					$( this ).off( 'canplay' );
					
					_self.audio.currentTime = data.timeInSong;
					_self.audio.play();
					_self.isMoving = true;

					_self._setWheelAnimation( '2s', 'play' );
					
				});

			}
		
			} );

		},
		_updateStatus		: function( buttons ) {
            
            var _self = this; // [!!! 請求 3 修正: 為計時器準備 _self !!!]
			var posTime	= this.cntTime;

			// first stop
			this._stop( true );

			this._setSidesPosStatus( 'middle' );

			// the current time to play is this.cntTime +/- [this.elapsed]
			if( this.lastaction === 'forward' ) {

				posTime += this.elapsed;

			}
			else if( this.lastaction === 'rewind' ) {

				posTime -= this.elapsed;

			}

			// check if we have more songs to play on the current side..
			if( posTime >= this._getSide().current.getDuration() ) {

				this._stop( buttons );
				this._setSidesPosStatus( 'end' );
                
                // [!!! 請求 3 修正: 啟動自動翻面計時器 !!!]
                clearTimeout(this.flipTimer); // 再次清除以防萬一
                this.flipTimer = setTimeout(function() {
                    _self._switchSides();
                    _self._play();
                }, 15000); // 15 秒
                
				return false;

			}

			this._resetElapsed();

			// given this, we need to know which song is playing at this point in time,
			// and from which point in time within the song we will play
			var data			= this._getSongInfoByTime( posTime );

			// update cntTime
			this.cntTime		= posTime;
			// update timeIterator
			this.timeIterator	= data.iterator;

			return data;

		},
		_rewind				: function() {
            
            // [!!! 請求 3 修正: 取消計時器 !!!]
            clearTimeout(this.flipTimer);

			var _self	= this,
				action 	= 'rewind';

			if( this._getSide().current.getPositionStatus() === 'start' ) {

				return false;
				
			}

			this._updateButtons( action );

			$.when( this.sound.play( 'click' ) ).done( function() {

				_self._updateStatus( true );
				_self.isMoving = true;

				_self._updateAction( action );
				_self.sound.play( 'rewind', true );
				_self._setWheelAnimation( '0.5s', action );
				_self._timer();

			} );
			
		},
		_forward			: function() {
            
            // [!!! 請求 3 修正: 取消計時器 !!!]
            clearTimeout(this.flipTimer);

			var _self	= this,
				action 	= 'forward';

			if( this._getSide().current.getPositionStatus() === 'end' ) {

				return false;

			}

			this._updateButtons( action );

			$.when( this.sound.play( 'click' ) ).done( function() {
			
				_self._updateStatus( true );
				_self.isMoving = true;
			
				_self._updateAction( action );
				_self.sound.play( 'fforward', true );
				_self._setWheelAnimation( '0.5s', action );
				_self._timer();

			} );

		},
		_stop				: function( buttons ) {
			
            var _self = this; 

			if( !buttons ) { 

				this._updateButtons( 'stop' );
				this.sound.play( 'click' );
                
                // [!!! 請求 3 修正: 手動停止時取消計時器 !!!]
                clearTimeout(this.flipTimer);
			}
            
			this.isMoving = false;
			this._stopWheels();
			this.audio.pause();
			this._stopTimer();
            
            if (!buttons) {
                this._stopKaraoke(); 
                this.$subtitleContainer.empty(); 
                
                // [!!! 請求 1 修正: 使用 class 隱藏 !!!]
                this.$imageContainer.removeClass('image-visible');
                this.$trackImage.removeAttr('src');
            }
		
		},
		_clear				: function() {
			
			this.$audioEl.children( 'source' ).remove();
		
		},
		_setSidesPosStatus	: function( position ) {

			this._getSide().current.setPositionStatus( position );

			switch( position ) {

				case 'middle'	: this._getSide().reverse.setPositionStatus( position );break;
				case 'start'	: this._getSide().reverse.setPositionStatus( 'end' );break;
				case 'end'		: this._getSide().reverse.setPositionStatus( 'start' );break;

			}

		},
		// given a point in time for the current side, returns the respective song of that side and the respective time within the song
		_getSongInfoByTime	: function( time ) {

			var data		= { songIdx : 0, timeInSong : 0 },
				side		= this._getSide().current,
				playlist	= side.getPlaylist(),
				len			= side.getPlaylistCount(),
				cntTime		= 0;

			for( var i = 0; i < len; ++i ) {

				var song		= playlist[ i ],
					duration	= song.getDuration();

				cntTime += duration;

				if( cntTime > time ) {

					data.songIdx	= i;
					data.timeInSong	= time - ( cntTime - duration );
					data.iterator	= cntTime - duration;

					return data;

				}

			}

			return data;

		},
		_getWheelValues		: function( x ) {

			var T	= this._getSide().current.getDuration(),
				val = {
					left	: ( this.currentSide === 1 ) ? ( -70 / T ) * x + 70 : ( 70 / T ) * x,
					right	: ( this.currentSide === 1 ) ?  ( 70 / T ) * x : ( -70 / T ) * x + 70
				};
			return val;

		},
		_getPosTime			: function() {

			var wleft	= this.$wheelLeft.data( 'wheel' ),
				wright	= this.$wheelRight.data( 'wheel' );

			if( wleft === undefined ) {

				wleft = 70;

			}
			if( wright === undefined ) {

				wright = 0;
				
			}
			
			var T		= this._getSide().current.getDuration(),
				posTime	= this.currentSide === 2 ? ( T * wleft ) / 70 : ( T * wright ) / 70;

			return posTime;

		},
		_updateWheelValue	: function( wheelVal ) {

			this.$wheelLeft.data( 'wheel', wheelVal.left ).css( { 'box-shadow' : '0 0 0 ' + wheelVal.left + 'px black' } );
			this.$wheelRight.data( 'wheel', wheelVal.right ).css( { 'box-shadow' : '0 0 0 ' + wheelVal.right + 'px black' } );

		},
		_setWheelAnimation	: function( speed, mode ) {

			var _self = this, anim 	= '';

			switch( this.currentSide ) {

				case 1 :
					if( mode === 'play' || mode === 'forward' ) {
						anim = 'rotateLeft';
					}
					else if( mode === 'rewind' ) {
						anim = 'rotateRight';
					}
					break;
				case 2 :
					if( mode === 'play' || mode === 'forward' ) {
						anim = 'rotateRight';
					}
					else if( mode === 'rewind' ) {
						anim = 'rotateLeft';
					}
					break;

			}

			var animStyle = { 
				'-webkit-animation'	: anim + ' ' + speed + ' linear infinite forwards',
				'-moz-animation'	: anim + ' ' + speed + ' linear infinite forwards',
				'-o-animation'		: anim + ' ' + speed + ' linear infinite forwards',
				'-ms-animation'	: anim + ' ' + speed + ' linear infinite forwards',
				'animation'			: anim + ' ' + speed + ' linear infinite forwards'
			};

			setTimeout( function() {

				_self.$wheelLeft.css(animStyle);
				_self.$wheelRight.css(animStyle);

			}, 0 );			

		},
		_stopWheels			: function() {

			var wheelStyle = {
				'-webkit-animation'	: 'none',
				'-moz-animation'	: 'none',
				'-o-animation'		: 'none',
				'-ms-animation'	: 'none',
				'animation'			: 'none'
			}

			this.$wheelLeft.css( wheelStyle );
			this.$wheelRight.css( wheelStyle );

		},
		// credits: http://www.sitepoint.com/creating-accurate-timers-in-javascript/
		_timer				: function() {

			var _self	= this,
				start	= new Date().getTime(),  
				time	= 0;

			this._resetElapsed();

			this.isSeeking = true;
			
			this._setSidesPosStatus( 'middle' );
			
			if( this.isSeeking ) {
			
				clearTimeout( this.timertimeout );
				this.timertimeout = setTimeout( function() {

					_self._timerinstance( start, time );

				}, 100 );
			
			}

		},
		_timerinstance		: function( start, time ) {

			var _self = this;	

			time += 100;  
			
			this.elapsed = Math.floor(time / 20) / 10;  
			
			if( Math.round( this.elapsed ) == this.elapsed ) { 

				this.elapsed += 0.0;

			}  
			
			// stop if it reaches the end of the cassette / side
			// or if it reaches the beginning
			var posTime = this.cntTime;

			if( this.lastaction === 'forward' ) {

				posTime += this.elapsed;

			}
			else if( this.lastaction === 'rewind' ) {

				posTime -= this.elapsed;

			}

			var wheelVal = this._getWheelValues( posTime );
			this._updateWheelValue( wheelVal );

			if( posTime >= this._getSide().current.getDuration() || posTime <= 0 ) {

				this._stop();
				( posTime <= 0) ? this.cntTime = 0 : this.cntTime = posTime;
				this._resetElapsed();
				( posTime <= 0) ? this._setSidesPosStatus( 'start' ) : this._setSidesPosStatus( 'end' );
				return false;

			}

			var diff = (new Date().getTime() - start) - time;  
			
			if( this.isSeeking ) {

				clearTimeout( this.timertimeout );
				this.timertimeout = setTimeout( function() {

					_self._timerinstance( start, time );

				}, ( 100 - diff ) );

			}

		},
		_stopTimer			: function() {

			clearTimeout( this.timertimeout );
			this.isSeeking = false;

		},
		_resetElapsed		: function() {

			this.elapsed = 0.0;

		},
        
        // --- [!! KTV 驅動函數 (維持不變) !!] ---
        
        _startKaraoke: function() {
            var _self = this;
            _self._stopKaraoke(); 
            _self._tickKaraoke(); 
        },
        
        _stopKaraoke: function() {
            if (this.raf) {
                cancelAnimationFrame(this.raf);
                this.raf = null;
            }
        },
        
        _tickKaraoke: function() {
            var _self = this;
            _self._updateKaraoke(); 
            
            this.raf = requestAnimationFrame(this._tickKaraoke.bind(this));
        },
        
        /* [!!! 維持使用原生 JS 語法 !!!] */
        _updateKaraoke: function() {
            var t = this.audio.currentTime;
            var cueNodes = this.$subtitleContainer.find('.cue');
            
            cueNodes.each(function() {
                var cn = $(this);
                var front = cn.find('.front'); 
                
                if (front.length === 0) return; 
                var frontEl = front[0]; 
                
                var s = parseFloat(cn.data('start'));
                var e = parseFloat(cn.data('end'));

                if (t >= s && t <= e) {
                    cn.show();
                    var pct = Math.max(0, Math.min(1, (t - s) / (e - s)));
                    var leftPct = pct * 100;
                    
                    frontEl.style.setProperty('--left', leftPct.toFixed(2) + '%');
                    
                } else if (t > e) {
                    frontEl.style.setProperty('--left', '100%'); 
                    cn.hide(); 
                } else {
                    frontEl.style.setProperty('--left', '0%');
                    cn.hide(); 
                }
            });
        }
        // --- [ KTV 函數結束 ] ---

	};
	
	// Cassette side obj
	$.Side					= function( id, playlist, status ) {
	
		// side's name / id
		this.id 		= id;
		// status is "start", "middle" or "end"
		this.status		= status;
		// array of songs sorted by song id
		this.playlist	= playlist.sort( function( a, b ) {
			
			var aid = a.id,
				bid	= b.id;
			
			return ( ( aid < bid ) ? -1 : ( ( aid > bid ) ? 1 : 0 ) );
			
		} );

		// set playlist duration
		this._setDuration();
		// total number of songs
		this.playlistCount	= playlist.length;
		
	};
	
	$.Side.prototype 		= {

		getSong				: function( num ) {
		
			return this.playlist[ num ];
		
		},
		getPlaylist			: function() {
			
			return this.playlist;
		
		},
		_setDuration		: function() {
		
			this.duration = 0;
			
			for( var i = 0, len = this.playlist.length; i < len; ++i ) {
			
				this.duration += this.playlist[ i ].duration;
			
			}
		
		},
		getDuration			: function() {
			
			return this.duration;
		
		},
		getPlaylistCount	: function() {
		
			return this.playlistCount;
		
		},
		setPositionStatus	: function( status ) {

			this.status = status;

		},
		getPositionStatus	: function() {

			return this.status;

		}

	};
	
	// Song obj
	$.Song 					= function( name, id ) {
		
		this.id		= id;
		this.name 	= name;
		this._init();
		
	};
	
	$.Song.prototype 		= {

		_init				: function() {
		
            /* [!! 恢復您的音訊連結 !!] */
			this.sources	= {
				mp3	: 'https://mon-ami.up.seesaa.net/topik/' + this.name + '.mp3',
				ogg	: 'https://mon-ami.up.seesaa.net/topik/' + this.name + '.ogg'
			};
		
		},
		getSource			: function( type ) {
			
			return this.sources[type];
		
		},
		// load metadata to get the duration of the song
		loadMetadata		: function() {
			
			var _self = this;
			
			return $.Deferred(
			
				function( dfd ) {
					
					var $tmpAudio 	= $( '<audio/>' ),
						songsrc		= _self.getSource( aux.getSupportedType() );
					
					$tmpAudio.attr( 'preload', 'auto' );
					$tmpAudio.attr( 'src', songsrc );
						
					$tmpAudio.on( 'loadedmetadata', function( event ) {
						
						_self.duration = $tmpAudio.get(0).duration;
						dfd.resolve( _self );
						
					});

                    // [!! 修正 !!] 增加錯誤處理
                    $tmpAudio.on( 'error', function( event ) {
                        console.log("Error loading audio: " + songsrc);
                        // [!! 關鍵 !!] 即使音訊 404, 也要回傳一個 "假的" 時長, 
                        // 否則 _createSides 的 $.when 會卡住
                        _self.duration = 10; // 給一個假的 10 秒時長
                        dfd.resolve( _self ); // 繼續執行
                    });
					
				}
				
			).promise();
		
		},
		getDuration			: function() {
		
			return this.duration;
		
		}

	};
    
	
	// Sound obj
	$.Sound					= function() {
		
		this._init();
		
	};
	
	$.Sound.prototype		= {

		_init				: function() {

			this.$audio	= $( '<audio/>' ).attr( 'preload', 'auto' );
		
		},
		getSource			: function( type ) {

			return 'https://kiyoshichang.github.io/cassette/sounds/' + this.action + '.' + type;
		
		},
		play				: function( action, loop ) {
			
			var _self = this;
			return $.Deferred( function( dfd ) {

				_self.action = action;

				var soundsrc = _self.getSource( aux.getSupportedType() );
				
				_self.$audio.attr( 'src', soundsrc );
				if( loop ) {

					_self.$audio.attr( 'loop', loop );

				}
				else {

					_self.$audio.removeAttr( 'loop' );

				}
					
				_self.$audio.on( 'canplay', function( event ) {
					
					// TODO: change timeout to ended event . ended event does not trigger for safari ?
					setTimeout( function() {

						dfd.resolve();

					}, 500 );
					$( this ).get(0).play();
					
				});

			});
		
		}

	};
	
	var logError 			= function( message ) {

		if ( window.console ) {

			window.console.error( message );
		
		}

	};
	
	$.fn.cassette			= function( options ) {
		
		if ( typeof options === 'string' ) {
			
			var args = Array.prototype.slice.call( arguments, 1 );
			
			this.each(function() {
			
				var instance = $.data( this, 'cassette' );
				
				if ( !instance ) {

					logError( "cannot call methods on cassette prior to initialization; " +
					"attempted to call method '" + options + "'" );
					return;
				
				}
				
				if ( !$.isFunction( instance[options] ) || options.charAt(0) === "_" ) {

					logError( "no such method '" + options + "' for cassette instance" );
					return;
				
				}
				
				instance[ options ].apply( instance, args );
			
			});
		
		} 
		else {
		
			this.each(function() {
			
				var instance = $.data( this, 'cassette' );
				if ( !instance ) {
					$.data( this, 'cassette', new $.Cassette( options, this ) );
				}
			});
		
		}
		
		return this;
		
	};
	
} )( window, jQuery );
</script>

		<script type="text/javascript">	
			$(function() {
				
				// 1. 你原本的程式碼
				$( '#vc-container' ).cassette();


				// 2. [!!! 請求 2 修正: 窄螢幕捲軸修正 !!!] 
				function resizeCassette() {
					
                    /* [!!! 請求 2 修正: 偵測頁寬 !!!] */
					var windowWidth = document.documentElement.clientWidth; 
					var $container = $('body > .container');
                    var containerEl = $container[0]; 
                    
                    /* [!!! 請求 2 修正: 
                     * 錯誤的基準寬度。560px 是 container 寬度, 
                     * 但最寬的元件 (錄音帶) 是 586px。
                     * 我們必須用 586px 作為縮放基準, 
                     * 這樣 586px * (螢幕寬 / 586px) = 螢幕寬
                     * !!!] 
                     */
					var baseWidth = 586; // 原本是 560

                    // 確保 containerEl 真的存在
                    if (!containerEl) {
                        return;
                    }

					if (windowWidth < baseWidth) {
						// --- 窄螢幕 (< 586px) ---
						var scale = windowWidth / baseWidth;

						containerEl.style.setProperty('transform', 'scale(' + scale + ')', 'important');
						containerEl.style.setProperty('transform-origin', 'top left', 'important');
						containerEl.style.setProperty('margin-left', '0', 'important');
						containerEl.style.setProperty('margin-right', '0', 'important'); 
                        
                        /* [!!! 請求 2 修正: 移除 body padding 控制 (已由 CSS 處理) !!!] */

					} else {
						// --- 寬螢幕 (>= 586px) ---
						// 恢復所有設定，讓 CSS 'margin: 0 auto !important' 重新生效
						containerEl.style.setProperty('transform', 'none', 'important');
						containerEl.style.setProperty('transform-origin', 'top left', 'important');
						containerEl.style.setProperty('margin-left', 'auto', 'important');
						containerEl.style.setProperty('margin-right', 'auto', 'important');
                        
                        /* [!!! 請求 2 修正: 移除 body padding 控制 (已由 CSS 處理) !!!] */
					}
				}

				// 頁面載入時執行一次
				resizeCassette();

				// 當視窗 (或 iFrame) 改變大小時再次執行
				$(window).on('resize', resizeCassette);
						
			});
		</script>
    <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'948b55fd80f2b308',t:'MTc0ODc0NTUxOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>